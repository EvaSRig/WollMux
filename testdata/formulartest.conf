WM(
 Formular(
   TITLE "SA 98.x Abtretungserklärung"
   Fenster( # Heisst Fenster wg. Analogie zu AbsenderdatenBearbeiten, ausserdem 
            # evtl. Realisierung über Fenster statt Tabs
     Empfaenger(
       TITLE "Empfänger"
       CLOSEACTION "abort"
       Eingabefelder(
         (LABEL "Anrede" TIP "Anrede des Empfängers" TYPE "combobox" 
            VALUES ("Herr", "Frau") ID "EmpfaengerAnrede" TIP "Ja was wohl?"
            
            AUTOFILL(DIALOG("EmpfaengerKrankenkassen","Anrede"))
              # wird jedes mal wenn sich eines der Felder aus DEPENDS ändert
              # neu berechnet, AUSSER der Benutzer hat schon einmal den Wert
              # geändert
            AUTOFILL(INVOKE("id" ARG("Arg1" VALUE("EmpfaengerAnrede) )))
         )
         (LABEL "Vorname" TYPE "textfield" ID "EmpfaengerVorname" 
            DEFAULT(DB "Empfaenger" DB_SPALTE "Vorname")
            TIP "Ist doch selbsterklärend"
         )
         (LABEL "Nachname" TYPE "textfield" ID "EmpfaengerNachname"
            DEFAULT(DB "Empfaenger" DB_SPALTE "Nachname")
         )
         (LABEL "Straße Hausnummer" TYPE "textfield" ID "EmpfaengerStrasse"
            DEFAULT(DB "Empfaenger" DB_SPALTE "Strasse")
         )
         (LABEL "PLZ" TYPE "textfield" ID "EmpfaengerPLZ"
            DEFAULT(DB "Empfaenger" DB_SPALTE "PLZ")
         )
         (LABEL "Ort" TYPE "textfield" ID "EmpfaengerOrt"
            DEFAULT(DB "Empfaenger" DB_SPALTE "Ort")
         )
         (LABEL "Freitext" TYPE "textarea" ID "freitext"
            AUTOFILL( IF_THEN(MATCH("Ablehnung","true"), "Das tut mir aber leid.")
                      IF_THEN(MATCH("Ablehnung","false), "Herzlichen Glueckwunsch.")
                     )
         )
         (LABEL "Besondere Merkmale" TYPE "textarea" LINES "4" ID "Merkmale" TIP "z.B. ""Hakennase"" oder ""Doppelkinn""")

         (TYPE "glue")
       )
       Buttons(
         (LABEL "Abbrechen"  TYPE "button" HOTKEY "A"  ACTION "abort" TIP "Hier klicken wenn Kaffeepause")
         (TYPE "glue" MINSIZE "20")
         (LABEL "Adressauswahl" TYPE "button" HOTKEY "A"  ACTION "dbSelect" DIALOG "EmpfaengerKrankenkassen")
         (LABEL "Weiter->"  TYPE "button" HOTKEY "W"  ACTION "nextTab")
       )
     )
     
     Sicherungsgeber(
       TITLE "Sicherungsgeber"
       CLOSEACTION "abort"
       Eingabefelder(
         (LABEL "Anrede" TYPE "combobox" VALUES ("Herr", "Frau") ID "SGAnrede" 
            EDIT "true" 
            PLAUSI(INVOKE("NichtLeerNurBuchstaben", MAP("Arg1" "SGAnrede") SET("Untergrenze" "10") SET ("Obergrenze" "100")))

         )
         (LABEL "Vorname" TYPE "textfield" ID "SGVorname"
           PLAUSI(FUNCTION( URL "vnd.sun.star.script:Plausi.Module1.startsWithA?language=Basic&location=application" DEPENDS "SGVorname"))
         )
         (LABEL "Nachname" TYPE "textfield" ID "SGNachname")
         (LABEL "wohnhaft in" TYPE "textfield" ID "SGAdresse")
         (TYPE "glue")
       )
       Buttons(
         (LABEL "Abbrechen"  TYPE "button" HOTKEY "A"  ACTION "abort")
         (TYPE "glue" MINSIZE "20")
         (LABEL "<-Zurück"  TYPE "button" HOTKEY "Z"  ACTION "prevTab")
         (LABEL "Weiter->"  TYPE "button" HOTKEY "W"  ACTION "nextTab")
       )
     )
       
     Darlehen(
       TITLE "Darlehen/Abtretungen"
       CLOSEACTION "abort"
       Eingabefelder(
         (LABEL "Darlehensbetrag (EUR)" TYPE "textfield" ID "DarlBetrag" 
            # Das Feld, das das Plausiattribut hat wird rot, wenn die Plausi false
            # liefert.
            # Die Plausi wird nur ausgewertet (insbes. bei Drucken-Knopf), wenn
            # alle Felder von denen ihre Bedingung abhängt UND das Rotzumarkierende Feld
            # sichtbar/eingeblendet sind.
            PLAUSI(AND(MATCH("DarlBetrag","[0-9]+") ) )
            PLAUSI(FUNCTION(URL "java:de.muenchen.allg.itd51.wollmux.Plausi.zahlenBereich" PARAM "10" PARAM "100" DEPENDS "DarlBetrag") )
            PLAUSI(FUNCTION "functionidvonunten" ARGS("depends1" "$(Anrede)" "arg1" "der" "arg2" "die"))
         )
         (LABEL "gewährt am (TT.MM.JJJJ)" TYPE "textfield" ID "DarlDatum" 
            PLAUSI(FUNCTION(URL "..." PARAM "p1" DEPENDS("id1","id2")) ) 
         )
         (TYPE "separator")
         (LABEL "Der Sicherungsgeber tritt folgende Forderungen an die LHM ab:" TYPE "label")
         (LABEL "Lohn, Gehalt, Sozialleistungsansprüche" TYPE "checkbox" ID "AbtLohn")
         (LABEL "Genossenschaftsanteile" TYPE "checkbox" ID "AbtAnteile")
         (LABEL "Kaution für Wohnung" TYPE "checkbox" ID "AbtKaution")
         (LABEL "Lebensversicherung" TYPE "checkbox" ID "AbtVersicherung")
         (TYPE "glue")
       )
       Buttons(
         (LABEL "Abbrechen" TYPE "button" HOTKEY "A"  ACTION "abort")
         (TYPE "glue" MINSIZE "20")
         (LABEL "<-Zurück"  TYPE "button" HOTKEY "Z"  ACTION "prevTab")
         (LABEL "Weiter->"  TYPE "button" HOTKEY "W"  ACTION "nextTab")
       )
     )
     
     Details(
       TITLE "Abtretung Details"
       CLOSEACTION "abort"
	     Eingabefelder(
	       (LABEL "Lohn, Gehalt, Sozialleistungsansprüche" TYPE "label" GROUPS("AbtLohn"))
	       (LABEL "gegen den" TYPE "combobox" GROUPS("AbtLohn") VALUES ("Arbeitgeber", "Dienstherren") ID "ArbeitgeberDienstherren" )
	       (LABEL "aus einem" TYPE "combobox" GROUPS("AbtLohn") VALUES ("Arbeitsverhältnis", "Dienstverhältnis") ID "ArbeitsverhaeltnisDienstverhaeltnis" )
	       
	       (TYPE "separator" GROUPS "AbtAnteile")
	       
	       (LABEL "Genossenschaftsanteile" TYPE "label" GROUPS("AbtAnteile"))
	       (LABEL "Anspruch auf Rückzahlung" TYPE "combobox" GROUPS("AbtAnteile") VALUES ("des Genossenschaftsanteils", "der Genossenschaftsanteile") ID "DesDerGenossenschaftsanteileS" )
	       (LABEL "in Höhe von (EUR)" TYPE "textfield" GROUPS("AbtAnteile") ID "GABetrag" )
	       (LABEL "gegen" TYPE "textfield" GROUPS("AbtAnteile") ID "Genossenschaft" )
	       
	       (TYPE "separator" GROUPS "AbtKaution" )
	
	       (LABEL "Kaution für Wohnung" TYPE "label" GROUPS("AbtKaution"))
	       (LABEL "Adresse" TYPE "textfield" GROUPS("AbtKaution") ID "KautionWohnungAdresse" )
	       (LABEL "in Höhe von (EUR)" TYPE "textfield" GROUPS("AbtKaution") ID "KautionWohnungBetrag" )
	
	       (TYPE "separator" GROUPS "AbtVersicherung")
	
	       (LABEL "Lebensversicherung" TYPE "label" GROUPS("AbtVersicherung"))
	       (LABEL "Versicherungs-Nr." TYPE "textfield" GROUPS("AbtVersicherung") ID "Versicherungsnummer" )
	       (LABEL "bei Institut" TYPE "textfield" GROUPS("AbtVersicherung") ID "Versicherungsinstitut" )
	
	       (TYPE "glue")
	     )
	     Buttons(
	       (LABEL "Abbrechen"  TYPE "button" HOTKEY "A"  ACTION "abort")
	       (TYPE "glue" MINSIZE "20")
	       (LABEL "<-Zurück"  TYPE "button" HOTKEY "Z"  ACTION "prevTab")
	       (LABEL "Dokument Bearbeiten"  TYPE "button" HOTKEY "B"  ACTION "openFormInWriter")
	       (LABEL "PDF"  TYPE "button" HOTKEY "B"  ACTION "form2PDF")
	       (LABEL "Drucken"  TYPE "button" HOTKEY "D"  ACTION "printForm")
	     )
	   )  
   )
   
   Sichtbarkeit
   (
     AbtLohn(MATCH(VALUE("AbtLohn"),"true"))
     AbtAnteile(MATCH("AbtAnteile","true"))
     AbtKaution(MATCH("AbtKaution","true"))
     AbtVersicherung(VALUE("AbtVersicherung"))
     #AbtLV(AND(MATCH("AbtLV","true") FUNCTION(URL "..." PARAM "p1" DEPENDS("id1","id2"))))
     #Foo(Foo(MATCH "Prognose"))
   )

   Funktionen #global in wollmux.conf, nicht so sinnvoll in Formularbeschreibung selbst
   (
     AnredeSuffix(EXTERN(URL "vnd.sun.star.script:WollMux.Trafo.MannOderFrau?language=Basic&location=application" PARAMS("Anrede", "SuffixWeibl", "SuffixMaennl")))
     SGAnredederdie(BIND( FUNCTION("AnredeSuffix") SET("AnredeWeibl" "die") SET("AnredeMaennl" "der" ) SET("Anrede" VALUE("SGAnrede")))
     SGAnredeDerDie(FUNCTION( PARAM("Der","Die") DEPENDS "SGAnrede" URL "vnd.sun.star.script:WollMux.Trafo.MannOderFrau?language=Basic&location=application" ))
     SGAnredeseinihr(FUNCTION( PARAM("sein","ihr") DEPENDS "SGAnrede" URL "vnd.sun.star.script:WollMux.Trafo.MannOderFrau?language=Basic&location=application" ))
     SGAnreder(FUNCTION( PARAM("r","") DEPENDS "SGAnrede" URL "vnd.sun.star.script:WollMux.Trafo.MannOderFrau?language=Basic&location=application" ))
     SGAnredein(FUNCTION( PARAM("","in") DEPENDS "SGAnrede" URL "vnd.sun.star.script:WollMux.Trafo.MannOderFrau?language=Basic&location=application" ))
     NichtLeerNurBuchstaben(MATCH(ARG("Arg1"),"[a-zA-Z]+"))
     funktionvonunten(FUNCTION( PARAM("arg1","arg2") DEPENDS "depend1" URL "vnd.sun.star.script:WollMux.Trafo.MannOderFrau?language=Basic&location=application" ))
     FormatiereTel(LABEL "Telefonnumer formatieren" FUNCTION(URL "..." DEPENDS "nummerOhneLeerzeichen"))
     #CMD 'insertValue' DB_SPALTE 'Telefon' TRAFO 'FormatiereTel'
     Entschuldigung(
       SELECT(
         IF( MATCH(VALUE("Status"), "abgelehnt") 
             THEN "Das tut uns aber traurig :-("  
         )
         IF( MATCH(VALUE("Status"), "angenommen") 
             THEN "Herzlichen Glückwunsch :-)"
         )
         ELSE "<Bitte Text einfügen>"
       )
     )
   )
   
 )
)
