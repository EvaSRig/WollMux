%include "ldap.conf"

Datenquellen(
  Datenquelle( 
    NAME "verkehrsverbindungen"
    TYPE "thingy"
    SUBTYPE "ordered"
    URL "verkehrsverbindungen.conf"
    Schluessel("Adresse")
  )

  Datenquelle(
    NAME "PersonalMitVerkehrsverbindungen"
    TYPE "join"
    
      # Gibt an, dass zur Erstellung der Menge der Join-Datensätze
      # jeder Datensatz aus SOURCE1 genau einmal verwendet werden
      # muss und jeder Datensatz aus SOURCE2 beliebig oft (auch keinmal)
      # verwendet werden darf. Dies verhindert
      #  a) dass eine Person 2 mal auftaucht, nur weil es 2 Einträge
      #     mit Verkehrsverbindungen für ihre Adresse gibt
      #  b) dass eine Person rausfliegt, weil es zu ihrer Adresse keine
      #     Verkehrsverbindung gibt
      # Dies sorgt gleichzeitig dafür, dass als Schlüsselattribute
      # nur die Attribute von SOURCE1 und nicht zusätzlich die von SOURCE2
      # verwendet werden, wodurch verhindert wird, 
      # dass ein Datensatz bei einer Änderung der Adresse aus der lokalen
      # Absenderliste fliegt, weil er beim Cache-Refresh nicht mehr
      # gefunden wird.
    SUBTYPE "1:0-*"
    
    SOURCE1 "ldap"
    SOURCE2 "verkehrsverbindungen"
    MATCH ("Dienstgebaeude" "Adresse")
  )
  
  Datenquelle(
    NAME "Personal"
    TYPE "rename"
    SOURCE "PersonalMitVerkehrsverbindungen"
    Spalten(
      ("OPNV1" "OEPNV1")
      ("OPNV2" "OEPNV2")
      ("OPNV3" "OEPNV3")
      ("OPNV4" "OEPNV4")
    )
  )
  
)
